---
import Container from './Container.astro';
import LanguageSwitcher from './LanguageSwitcher.astro';
import { getTranslations, getLocaleFromPath, getLocalePath } from '@/i18n';
import { SITE_NAME, WHATSAPP_LINK } from '@/lib/constants';
import logoDestapes from '@/assets/destapes-logo.svg';

const locale = getLocaleFromPath(Astro.url.pathname);
const t = getTranslations(locale);
---

<header class="fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-md border-b border-neutral-200 transition-all">
  <Container>
    <nav class="flex items-center justify-between h-16 sm:h-20">
      <!-- Logo -->
      <a href={getLocalePath(locale)} class="flex items-center space-x-3 group">
        <img
          src={logoDestapes.src}
          alt={SITE_NAME}
          class="h-10 sm:h-12 w-auto object-contain"
        />
        <span class="text-lg sm:text-xl font-bold text-primary-700 whitespace-nowrap hidden sm:block">{SITE_NAME}</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-6">
        <a
          href={`${getLocalePath(locale)}#features`}
          class="text-neutral-700 hover:text-primary-600 transition-colors font-medium text-sm"
        >
          {t.nav.features}
        </a>
        <a
          href={`${getLocalePath(locale)}#coverage`}
          class="text-neutral-700 hover:text-primary-600 transition-colors font-medium text-sm"
        >
          {t.nav.coverage}
        </a>
        <a
          href="/urgencias"
          class="text-neutral-700 hover:text-primary-600 transition-colors font-medium text-sm font-semibold"
        >
          Urgencias 24/7
        </a>
        <a
          href={`${getLocalePath(locale)}#faq`}
          class="text-neutral-700 hover:text-primary-600 transition-colors font-medium text-sm"
        >
          {t.nav.faq}
        </a>
        <LanguageSwitcher currentLocale={locale} />
        <a
          href={WHATSAPP_LINK}
          target="_blank"
          rel="noopener noreferrer"
          class="px-4 py-2 bg-primary-700 text-white rounded-lg hover:bg-primary-600 transition-colors font-medium text-sm"
        >
          {t.nav.contact}
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 text-neutral-700 hover:text-primary-600 transition-colors"
        aria-label="Toggle menu"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M3 12h18M3 6h18M3 18h18" />
        </svg>
      </button>
    </nav>

    <!-- Mobile Navigation -->
    <div
      id="mobile-menu"
      class="hidden md:hidden pb-4 space-y-3 border-t border-neutral-200 mt-4"
    >
      <a
        href={`${getLocalePath(locale)}#features`}
        class="mobile-menu-link block text-neutral-700 hover:text-primary-600 transition-colors font-medium py-3 px-2 rounded-lg hover:bg-neutral-50"
      >
        {t.nav.features}
      </a>
      <a
        href={`${getLocalePath(locale)}#coverage`}
        class="mobile-menu-link block text-neutral-700 hover:text-primary-600 transition-colors font-medium py-3 px-2 rounded-lg hover:bg-neutral-50"
      >
        {t.nav.coverage}
      </a>
      <a
        href="/urgencias"
        class="mobile-menu-link block text-neutral-700 hover:text-primary-600 transition-colors font-medium py-3 px-2 rounded-lg hover:bg-neutral-50 font-semibold"
      >
        Urgencias 24/7
      </a>
      <a
        href={`${getLocalePath(locale)}#faq`}
        class="mobile-menu-link block text-neutral-700 hover:text-primary-600 transition-colors font-medium py-3 px-2 rounded-lg hover:bg-neutral-50"
      >
        {t.nav.faq}
      </a>
      <div class="pt-2 pb-2 border-t border-neutral-200 mt-2">
        <div class="px-2 py-2">
          <span class="text-xs font-semibold text-neutral-500 uppercase tracking-wide mb-3 block">
            Idioma
          </span>
          <div class="mobile-menu-link">
            <LanguageSwitcher currentLocale={locale} variant="mobile" />
          </div>
        </div>
      </div>
      <a
        href={WHATSAPP_LINK}
        target="_blank"
        rel="noopener noreferrer"
        class="mobile-menu-link block px-4 py-3 bg-primary-700 text-white rounded-lg hover:bg-primary-600 transition-colors font-medium text-center"
      >
        {t.nav.contact}
      </a>
    </div>
</header>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');

  function closeMenu() {
    if (menu) {
      menu.classList.add('hidden');
    }
  }

  function toggleMenu() {
    if (menu) {
      menu.classList.toggle('hidden');
    }
  }

  if (button && menu) {
    button.addEventListener('click', toggleMenu);

    // Cerrar el menú cuando se hace click en cualquier enlace
    const menuLinks = menu.querySelectorAll('.mobile-menu-link');
    menuLinks.forEach((link) => {
      link.addEventListener('click', (e) => {
        // Si es un contenedor, buscar el enlace dentro
        const actualLink = link.tagName === 'A' ? link : link.querySelector('a');
        if (actualLink) {
          // Pequeño delay para permitir la navegación antes de cerrar
          setTimeout(closeMenu, 100);
        }
      });
    });

    // Cerrar el menú cuando se hace click fuera de él
    document.addEventListener('click', (e) => {
      if (
        menu &&
        !menu.contains(e.target as Node) &&
        !button.contains(e.target as Node) &&
        !menu.classList.contains('hidden')
      ) {
        closeMenu();
      }
    });
  }
</script>
